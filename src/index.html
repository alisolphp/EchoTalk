<!DOCTYPE html>
<html lang="en" class="h-100" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>EchoTalk | Offline Shadowing Practice</title>
    <meta name="theme-color" content="#43b6fd">
    <link rel="icon" type="image/png" sizes="32x32" href="icons/icon-512.png">
</head>
<body class="d-flex flex-column h-100">
<div class="container my-4">
    <h1 class="text-center"><img src="icons/icon-512.png" style="width: 1em;"> EchoTalk</h1>
    <h2 class="mb-3 text-center">Offline Shadowing Practice</h2>

    <div class="row mb-2">
        <div class="col text-center">
            <div id="backHomeButton" class="d-none">
                <button class="btn btn-outline-secondary" onclick="location.reload()">« Back Home</button>
            </div>
            <button class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#quickStartModal">ⓘ Quick Start</button>
        </div>
    </div>

    <div id="configArea">
        <div class="row mb-3">
            <div class="col text-center d-flex justify-content-center gap-2">
                <button class="btn btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#optionsModal">Options</button>
                <button id="showRecordingsBtn" class="btn btn-outline-success" data-bs-toggle="modal" data-bs-target="#recordingsModal">My Records</button>
            </div>
        </div>
        <div class="mb-3">
            <label for="sentenceInput" class="form-label">Enter your sentence or
                <button id="useSampleBtn" class="btn btn-secondary small py-0 px-2 me-1">Use a random Sample</button>:
            </label>
            <textarea id="sentenceInput" class="form-control" placeholder="Type or pick a sample sentence"></textarea>
        </div>
        <div class="mb-3">
            <div id="sampleSentence" class="fs-5"></div>
            <small class="text-muted">Click any word to set the starting point.</small>
        </div>

        <div class="row mb-3">
            <div class="col">
                <button id="startBtn" class="btn btn-primary d-block w-100">Start Practice</button>
            </div>
        </div>
    </div>

    <div id="practiceArea" class="d-none">
        <div class="mb-3">
            <div id="fullSentence" class="fs-5 mb-2 d-none"></div>
            <button id="repeatBtn" style="margin-top: -0.3em;font-size: 20pt;text-shadow: 0px 0px 10px #59acf9;"
                    class="btn pt-1 pb-2 px-2">▶</button>
            <div id="sentence-container" class="fs-3 fw-bold mb-3 d-inline"></div>
        </div>
        <p id="instructionText">Now it’s your turn. Tap the mic icon on your keyboard and speak the word.</p>
        <div class="input-group mb-3">
            <input type="text" id="userInput" class="form-control" placeholder="Tap keyboard mic">
        </div>
        <div>
            <button id="checkBtn" class="btn btn-success d-block w-100 py-3">Check/Skip</button>
        </div>
        <div id="feedback" class="mb-3"></div>
    </div>

    <div id="optionsModal" class="modal fade" tabindex="-1" aria-labelledby="optionsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="optionsModalLabel">Practice Options <small class="text-muted">(Auto save)</small></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                    <div class="row mb-3">
                        <div class="col">
                            <label for="levelSelect" class="form-label">Select Level:</label>
                            <select id="levelSelect" class="form-select"></select>
                        </div>
                        <div class="col">
                            <label for="categorySelect" class="form-label">Select Category:</label>
                            <select id="categorySelect" class="form-select"></select>
                        </div>
                    </div>

                    <div class="row mb-3">
                        <div class="col-12">
                            <label for="repsSelect" class="form-label">Repetitions:</label>
                            <select id="repsSelect" class="form-select"></select>
                        </div>
                        <!--                        <div class="col-6 d-flex align-items-end">-->
                                                    <button id="resetBtn" class="btn btn-outline-danger w-100 d-none">Reset App</button>
                        <!--                        </div>-->
                    </div>
                    <div class="mb-3">
                        <div class="form-check form-switch">
                            <input class="form-check-input" type="checkbox" role="switch" id="recordToggle">
                            <label class="form-check-label" for="recordToggle">Record my voice for comparing later (completely locally)</label>
                        </div>
                    </div>
                    <div class="card bg-dark-subtle p-3 mb-3">
                        <label class="form-label">Practice Mode:</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="practiceMode" id="mode-skip" value="skip" checked>
                            <label class="form-check-label" for="mode-skip">Skip-Only Mode (Listen and repeat yourself, then go next)</label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="practiceMode" id="mode-check" value="check">
                            <label class="form-check-label" for="mode-check">Check Mode (Use keyboard mic to check your pronunciation)</label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="quickStartModal" class="modal fade" tabindex="-1" aria-labelledby="quickStartModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="quickStartModalLabel">Quick Start Guide & Features</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>This tool is designed for Shadowing practice and works completely offline. To get started, you can either enter your own sentence or use one of the provided samples.</p>
                    <h5>Quick Start Guide:</h5>
                    <ol>
                        <li><strong>Enter your sentence:</strong> Type the text you want to practice into the text box.</li>
                        <li><strong>Or use a sample:</strong> Click the <strong>"Use a random Sample"</strong> button to load a random sentence.</li>
                        <li><strong>Select a Practice Mode:</strong>
                            <ul>
                                <li><strong>Check Mode:</strong> After listening, repeat the phrase using your keyboard's mic and press "Check" to evaluate your pronunciation.</li>
                                <li><strong>Skip-Only Mode:</strong> Simply listen, repeat to yourself, and then press "Next Step" to proceed. (This is the default mode).</li>
                            </ul>
                        </li>
                        <li>Press the <strong>"Start Practice"</strong> button to begin.</li>
                    </ol>
                    <hr>
                    <h5>Other Features:</h5>
                    <ul>
                        <li><strong>Start From Any Word:</strong> Before starting, click any word in the full sentence to set it as your starting point.</li>
                        <li><strong>Re-listen at Slow Speed:</strong> During practice, click the ▶ button at the beginning of the phrase to hear it again at a slower speed.</li>
                        <li><strong>Look Up Word Meanings:</strong> Click on any word in the phrase being displayed to search for its meaning on Google in a new tab.</li>
                        <li><strong>Record Your Voice:</strong> You can enable voice recording to save your attempts locally in your browser and compare them with the original audio later.</li>
                        <li><strong>Auto-Save Progress:</strong> Your settings and current progress are automatically saved, allowing you to easily continue your practice later.</li>
                    </ul>
                    <hr>
                    <p class="small text-muted">This tool works completely offline. No internet connection is required, and your privacy is protected as no data is sent to any server. Please ensure you have an English TTS (Text-to-Speech) engine installed on your device.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="wordActionsModal" tabindex="-1" aria-labelledby="wordActionsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="wordActionsModalLabel"></h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body text-center">
                    <div class="d-grid gap-2">
                        <button id="playWordBtn" class="btn btn-primary">Play Word Again</button>
                        <a id="searchPronunciationLink" href="#" target="_blank" class="btn btn-outline-info">How to Pronounce</a>
                        <a id="searchMeaningLink" href="#" target="_blank" class="btn btn-outline-light">Search Meaning</a>
                        <a id="searchExamplesLink" href="#" target="_blank" class="btn btn-outline-secondary">Usage Examples</a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="recordingsModal" tabindex="-1" aria-labelledby="recordingsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-scrollable">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="recordingsModalLabel">My Recordings</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="accordion" id="recordingsList"></div>
                </div>
            </div>
        </div>
    </div>

</div>

<button id="installBtn" class="btn btn-outline-primary d-none">Install App</button>

<script type="module" src="assets/js/app.ts"></script>
</body>
</html>